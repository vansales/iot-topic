# üì° IoT Topic Specification: Locker System (32-Channel)

IoT Topic ‡πÅ‡∏•‡∏∞ Payload ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö Locker ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏î‡πâ‡∏ß‡∏¢ MOSFET 32 ‡∏ä‡πà‡∏≠‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö QR Payment

---

## ‚úÖ 1. Heartbeat Check

### üìå Topic

```
device/{machine_id}/status
```

* ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á heartbeat ‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏à‡∏≤‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏°‡∏≤‡∏¢‡∏±‡∏á Cloud
* ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏±‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

### ‚è± Publish Frequency

Every 5 minutes

### üîÅ Direction

Device ‚Üí Cloud

### üßæ Sample Payload

```json
{
  "machine_id": "mac_31287",
  "timestamp": 1702817270,
  "status": "online",
  "version": "1.0.0"
}
```
> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ñ‡πà‡∏≤ status: "online" ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á heartbeat ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡πÄ‡∏ä‡πà‡∏ô 5 ‡∏ô‡∏≤‡∏ó‡∏µ) ‡∏£‡∏∞‡∏ö‡∏ö‡∏ù‡∏±‡πà‡∏á Cloud ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏≤‡∏à "offline" ‡πÇ‡∏î‡∏¢‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤ status ‡∏ô‡∏µ‡πâ
---

## üõ† 2. Command (Cloud ‚Üí Device)

### üìå Topic

```
device/{machine_id}/cmd
```

* ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å Cloud ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Locker ‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏™‡∏î‡∏á QR ‡∏´‡∏£‡∏∑‡∏≠ ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á

### üîÅ Direction

Cloud ‚Üí Device

### üßæ Sample Payloads

#### üîì ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á
‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á Locker

```json
{
  "id": "9ac2f7d0-d053-4a3f-bb6c-2cfde3451aa7",
  "machine_id": "mac_31287",
  "command": "open",
  "params": {
    "locker": 16 
    "order_no": "ORD-20250622-0001",
  }
}
```

#### ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á Locker

```json
{
  "id": "9ac2f7d0-d053-4a3f-bb6c-2cfde3451aa7",
  "machine_id": "mac_31287",
  "command": "payment_received",
  "params": {
    "amount": 65.50 
    "order_no": "ORD-20250622-0001",
  }
}
```

#### ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏π‡πâ

```json
{
  "id": "9ac2f7d0-d053-4a3f-bb6c-2cfde3451aa7",
  "machine_id": "mac_31287",
  "command": "update_price",
  "params": {}
}
```

#### üí≥ ‡πÅ‡∏™‡∏î‡∏á QR Code

```json
{
  "id": "63e77a8a-36d4-44fd-865c-5584b7de0917",
  "machine_id": "mac_31287",
  "command": "display_qr",
  "params": {
    "qr_base64": "iVBORw0KGgoAAAANSUhEUgAA..."
    "order_no": "ORD-20250622-0001",
  }
}
```

#### üìù ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

```json
{
  "id": "7f13c9f4-55b6-4c7f-b269-4814b0701cd5",
  "machine_id": "mac_31287",
  "command": "msg_display",
  "params": {
    "message": "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£"
  }
}
```

#### ‚ôªÔ∏è ‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (refill ‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á)

```json
{
  "id": "e7b455c2-3a8f-4a33-8872-267317705157",
  "machine_id": "mac_31287",
  "command": "refill_all"
}
```

#### Reset

```json
{
  "id": "e7b455c2-3a8f-4a33-8872-267317705157",
  "machine_id": "mac_31287",
  "command": "reset"
}
```

#### Reset

```json
{
  "id": "e7b455c2-3a8f-4a33-8872-267317705157",
  "machine_id": "mac_31287",
  "command": "restart"
}
```

---

## üì¨ 3. Action Response (Device ‚Üí Cloud)

### üìå Topic

```
device/{machine_id}/act
```

* ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å Cloud ‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏™‡∏î‡∏á QR

### üîÅ Direction

Device ‚Üí Cloud

### üßæ Sample Payload

Command ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å Server ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏ö‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

```json
{
  "id": "9ac2f7d0-d053-4a3f-bb6c-2cfde3451aa7",
  "machine_id": "mac_31287",
  "command": "open", 
  "timestamp": 1702817285,
  "result": "success"
}
```

---

## üß† 4. User Event (Device ‚Üí Cloud)

### üìå Topic

```
device/{machine_id}/event
```

* ‡πÅ‡∏à‡πâ‡∏á event ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏ï‡∏π ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏ì‡∏µ‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥

### üîÅ Direction

Device ‚Üí Cloud

### üßæ Sample Payloads

#### üõí ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠

```json
{
  "event": "order",
  "machine_id": "mac_31287",
  "timestamp": 1702817300,
  "parameters": {
    "pack_type": "6_bottle_pack",
    "quantity": 2,
    "size": "1.5L"
  },
  "amount": 999
}
```


#### üîê ‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î
```json
{
  "event": "locker_closed",
  "machine_id": "mac_31287",
  "locker": 16,
  "timestamp": 1702817310
}
````

#### üîì ‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏¥‡∏î
```json
{
  "event": "locker_open",
  "machine_id": "mac_31287",
  "locker": 16,
  "timestamp": 1702817320
}
````

#### ‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î

```json
{
  "event": "payment_timeout",
  "machine_id": "mac_31287",
  "timestamp": 1702817400
}
```

#### ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏ì‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå

```json
{
  "event": "error",
  "machine_id": "mac_31287",
  "code": "locker_jam",
  "locker": 16,
  "message": "Cannot open locker",
  "timestamp": 1702817450
}
```

---

## üìã Summary of Topics

| Topic                        | Direction      | Description                    |
| ---------------------------- | -------------- | ------------------------------ |
| `device/{machine_id}/status` | Device ‚Üí Cloud | Heartbeat ‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ           |
| `device/{machine_id}/cmd`    | Cloud ‚Üí Device | ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á          |
| `device/{machine_id}/act`    | Device ‚Üí Cloud | ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à     |
| `device/{machine_id}/event`  | Device ‚Üí Cloud | ‡πÅ‡∏à‡πâ‡∏á Event ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô |

---

## üß† Best Practices

* ‡πÉ‡∏™‡πà `machine_id` ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å payload ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö trace ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥
* ‡πÉ‡∏ä‡πâ `uuid` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö `id` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö distributed system
* ‡πÉ‡∏ä‡πâ `result` ‡πÅ‡∏ó‡∏ô `status` ‡πÉ‡∏ô response ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏±‡∏ö‡∏™‡∏ô‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
* ‡πÉ‡∏ä‡πâ timestamp ‡πÅ‡∏ö‡∏ö UNIX Epoch (10 ‡∏´‡∏•‡∏±‡∏Å) ‡∏´‡∏£‡∏∑‡∏≠ ISO 8601 ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
* ‡πÉ‡∏ä‡πâ `snake_case` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÅ‡∏•‡∏∞ event ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠
* ‡πÉ‡∏ä‡πâ `version` ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô `status` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö firmware/device version ‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°
* ‡πÄ‡∏ß‡∏•‡∏≤ `timestamp` ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö `UTC` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ scale ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®
